{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/javascript/embed-api/components/active-users.js"],"names":["gapi","analytics","ready","createComponent","initialize","activeUsers","auth","once","handleSignOut_","bind","execute","polling_","stop","render_","isAuthorized","pollActiveUsers_","clearTimeout","timeout_","emit","opts","get","container","document","getElementById","innerHTML","template","querySelector","options","pollingInterval","isNaN","Error","client","data","realtime","ids","metrics","then","response","result","newValue","totalResults","rows","oldValue","onChange_","setTimeout","delta","valueContainer","handleSignIn_"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AAGAA,IAAI,CAACC,SAAL,CAAeC,KAAf,CAAqB,YAAW;AAC9BF,MAAI,CAACC,SAAL,CAAeE,eAAf,CAA+B,aAA/B,EAA8C;AAE5CC,cAAU,EAAE,sBAAW;AACrB,WAAKC,WAAL,GAAmB,CAAnB;AACAL,UAAI,CAACC,SAAL,CAAeK,IAAf,CAAoBC,IAApB,CAAyB,SAAzB,EAAoC,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAApC;AACD,KAL2C;AAO5CC,WAAO,EAAE,mBAAW;AAClB;AACA,UAAI,KAAKC,QAAT,EAAmB;AACjB,aAAKC,IAAL;AACD;;AAED,WAAKC,OAAL,GANkB,CAQlB;;AACA,UAAIb,IAAI,CAACC,SAAL,CAAeK,IAAf,CAAoBQ,YAApB,EAAJ,EAAwC;AACtC,aAAKC,gBAAL;AACD,OAFD,MAEO;AACLf,YAAI,CAACC,SAAL,CAAeK,IAAf,CAAoBC,IAApB,CAAyB,QAAzB,EAAmC,KAAKQ,gBAAL,CAAsBN,IAAtB,CAA2B,IAA3B,CAAnC;AACD;AACF,KArB2C;AAuB5CG,QAAI,EAAE,gBAAW;AACfI,kBAAY,CAAC,KAAKC,QAAN,CAAZ;AACA,WAAKN,QAAL,GAAgB,KAAhB;AACA,WAAKO,IAAL,CAAU,MAAV,EAAkB;AAACb,mBAAW,EAAE,KAAKA;AAAnB,OAAlB;AACD,KA3B2C;AA6B5CQ,WAAO,EAAE,mBAAW;AAClB,UAAMM,IAAI,GAAG,KAAKC,GAAL,EAAb,CADkB,CAGlB;;AACA,WAAKC,SAAL,GAAiB,OAAOF,IAAI,CAACE,SAAZ,IAAyB,QAAzB,GACbC,QAAQ,CAACC,cAAT,CAAwBJ,IAAI,CAACE,SAA7B,CADa,GAC6BF,IAAI,CAACE,SADnD;AAGA,WAAKA,SAAL,CAAeG,SAAf,GAA2BL,IAAI,CAACM,QAAL,IAAiB,KAAKA,QAAjD;AACA,WAAKJ,SAAL,CAAeK,aAAf,CAA6B,GAA7B,EAAkCF,SAAlC,GAA8C,KAAKnB,WAAnD;AACD,KAtC2C;AAwC5CU,oBAAgB,EAAE,4BAAW;AAC3B,UAAMY,OAAO,GAAG,KAAKP,GAAL,EAAhB;AACA,UAAMQ,eAAe,GAAG,CAACD,OAAO,CAACC,eAAR,IAA2B,CAA5B,IAAiC,IAAzD;;AAEA,UAAIC,KAAK,CAACD,eAAD,CAAL,IAA0BA,eAAe,GAAG,IAAhD,EAAsD;AACpD,cAAM,IAAIE,KAAJ,CAAU,sCAAV,CAAN;AACD;;AAED,WAAKnB,QAAL,GAAgB,IAAhB;AACAX,UAAI,CAAC+B,MAAL,CAAY9B,SAAZ,CAAsB+B,IAAtB,CAA2BC,QAA3B,CACKb,GADL,CACS;AAACc,WAAG,EAAEP,OAAO,CAACO,GAAd;AAAmBC,eAAO,EAAE;AAA5B,OADT,EAEKC,IAFL,CAEU,UAASC,QAAT,EAAmB;AACvB,YAAMC,MAAM,GAAGD,QAAQ,CAACC,MAAxB;AACA,YAAMC,QAAQ,GAAGD,MAAM,CAACE,YAAP,GAAsB,CAACF,MAAM,CAACG,IAAP,CAAY,CAAZ,EAAe,CAAf,CAAvB,GAA2C,CAA5D;AACA,YAAMC,QAAQ,GAAG,KAAKrC,WAAtB;AAEA,aAAKa,IAAL,CAAU,SAAV,EAAqB;AAACb,qBAAW,EAAE,KAAKA;AAAnB,SAArB;;AAEA,YAAIkC,QAAQ,IAAIG,QAAhB,EAA0B;AACxB,eAAKrC,WAAL,GAAmBkC,QAAnB;AACA,eAAKI,SAAL,CAAeJ,QAAQ,GAAGG,QAA1B;AACD;;AAED,YAAI,KAAK/B,QAAL,IAAiB,IAArB,EAA2B;AACzB,eAAKM,QAAL,GAAgB2B,UAAU,CAAC,KAAK7B,gBAAL,CAAsBN,IAAtB,CAA2B,IAA3B,CAAD,EACtBmB,eADsB,CAA1B;AAED;AACF,OAhBK,CAgBJnB,IAhBI,CAgBC,IAhBD,CAFV;AAmBD,KApE2C;AAsE5CkC,aAAS,EAAE,mBAASE,KAAT,EAAgB;AACzB,UAAMC,cAAc,GAAG,KAAKzB,SAAL,CAAeK,aAAf,CAA6B,GAA7B,CAAvB;AACA,UAAIoB,cAAJ,EAAoBA,cAAc,CAACtB,SAAf,GAA2B,KAAKnB,WAAhC;AAEpB,WAAKa,IAAL,CAAU,QAAV,EAAoB;AAACb,mBAAW,EAAE,KAAKA,WAAnB;AAAgCwC,aAAK,EAAEA;AAAvC,OAApB;;AACA,UAAIA,KAAK,GAAG,CAAZ,EAAe;AACb,aAAK3B,IAAL,CAAU,UAAV,EAAsB;AAACb,qBAAW,EAAE,KAAKA,WAAnB;AAAgCwC,eAAK,EAAEA;AAAvC,SAAtB;AACD,OAFD,MAEO;AACL,aAAK3B,IAAL,CAAU,UAAV,EAAsB;AAACb,qBAAW,EAAE,KAAKA,WAAnB;AAAgCwC,eAAK,EAAEA;AAAvC,SAAtB;AACD;AACF,KAhF2C;AAkF5CrC,kBAAc,EAAE,0BAAW;AACzB,WAAKI,IAAL;AACAZ,UAAI,CAACC,SAAL,CAAeK,IAAf,CAAoBC,IAApB,CAAyB,QAAzB,EAAmC,KAAKwC,aAAL,CAAmBtC,IAAnB,CAAwB,IAAxB,CAAnC;AACD,KArF2C;AAuF5CsC,iBAAa,EAAE,yBAAW;AACxB,WAAKhC,gBAAL;AACAf,UAAI,CAACC,SAAL,CAAeK,IAAf,CAAoBC,IAApB,CAAyB,SAAzB,EAAoC,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAApC;AACD,KA1F2C;AA4F5CgB,YAAQ,EACN,8BACE,iDADF,GAEA;AA/F0C,GAA9C;AAkGD,CAnGD,E","file":"active-users.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/javascript/embed-api/components/active-users.js\");\n","// Copyright 2015 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/* global gapi */\n\n\ngapi.analytics.ready(function() {\n  gapi.analytics.createComponent('ActiveUsers', {\n\n    initialize: function() {\n      this.activeUsers = 0;\n      gapi.analytics.auth.once('signOut', this.handleSignOut_.bind(this));\n    },\n\n    execute: function() {\n      // Stop any polling currently going on.\n      if (this.polling_) {\n        this.stop();\n      }\n\n      this.render_();\n\n      // Wait until the user is authorized.\n      if (gapi.analytics.auth.isAuthorized()) {\n        this.pollActiveUsers_();\n      } else {\n        gapi.analytics.auth.once('signIn', this.pollActiveUsers_.bind(this));\n      }\n    },\n\n    stop: function() {\n      clearTimeout(this.timeout_);\n      this.polling_ = false;\n      this.emit('stop', {activeUsers: this.activeUsers});\n    },\n\n    render_: function() {\n      const opts = this.get();\n\n      // Render the component inside the container.\n      this.container = typeof opts.container == 'string' ?\n          document.getElementById(opts.container) : opts.container;\n\n      this.container.innerHTML = opts.template || this.template;\n      this.container.querySelector('b').innerHTML = this.activeUsers;\n    },\n\n    pollActiveUsers_: function() {\n      const options = this.get();\n      const pollingInterval = (options.pollingInterval || 5) * 1000;\n\n      if (isNaN(pollingInterval) || pollingInterval < 5000) {\n        throw new Error('Frequency must be 5 seconds or more.');\n      }\n\n      this.polling_ = true;\n      gapi.client.analytics.data.realtime\n          .get({ids: options.ids, metrics: 'rt:activeUsers'})\n          .then(function(response) {\n            const result = response.result;\n            const newValue = result.totalResults ? +result.rows[0][0] : 0;\n            const oldValue = this.activeUsers;\n\n            this.emit('success', {activeUsers: this.activeUsers});\n\n            if (newValue != oldValue) {\n              this.activeUsers = newValue;\n              this.onChange_(newValue - oldValue);\n            }\n\n            if (this.polling_ == true) {\n              this.timeout_ = setTimeout(this.pollActiveUsers_.bind(this),\n                  pollingInterval);\n            }\n          }.bind(this));\n    },\n\n    onChange_: function(delta) {\n      const valueContainer = this.container.querySelector('b');\n      if (valueContainer) valueContainer.innerHTML = this.activeUsers;\n\n      this.emit('change', {activeUsers: this.activeUsers, delta: delta});\n      if (delta > 0) {\n        this.emit('increase', {activeUsers: this.activeUsers, delta: delta});\n      } else {\n        this.emit('decrease', {activeUsers: this.activeUsers, delta: delta});\n      }\n    },\n\n    handleSignOut_: function() {\n      this.stop();\n      gapi.analytics.auth.once('signIn', this.handleSignIn_.bind(this));\n    },\n\n    handleSignIn_: function() {\n      this.pollActiveUsers_();\n      gapi.analytics.auth.once('signOut', this.handleSignOut_.bind(this));\n    },\n\n    template:\n      '<div class=\"ActiveUsers\">' +\n        'Active Users: <b class=\"ActiveUsers-value\"></b>' +\n      '</div>',\n\n  });\n});\n"],"sourceRoot":""}